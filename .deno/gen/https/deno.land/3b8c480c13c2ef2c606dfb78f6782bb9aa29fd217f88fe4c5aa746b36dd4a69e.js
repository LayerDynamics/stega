import { tty } from "../ansi/tty.ts";
import { parse } from "../keycode/key_code.ts";
import { bold, brightBlue, dim, green, italic, red, stripColor, yellow } from "./deps.ts";
import { Figures } from "./_figures.ts";
/** Generic prompt representation. */ export class GenericPrompt {
  static injectedValue;
  cursor = {
    x: 0,
    y: 0
  };
  #value;
  #lastError;
  #isFirstRun = true;
  #encoder = new TextEncoder();
  /**
   * Inject prompt value. If called, the prompt doesn't prompt for an input and
   * returns immediately the injected value. Can be used for unit tests or pre
   * selections.
   *
   * @param value Input value.
   */ static inject(value) {
    GenericPrompt.injectedValue = value;
  }
  getDefaultSettings(options) {
    return {
      ...options,
      tty: tty({
        // Stdin is only used by getCursorPosition which we don't need.
        reader: Deno.stdin,
        writer: options.writer ?? Deno.stdout
      }),
      cbreak: options.cbreak ?? false,
      reader: options.reader ?? Deno.stdin,
      writer: options.writer ?? Deno.stdout,
      pointer: options.pointer ?? brightBlue(Figures.POINTER_SMALL),
      prefix: options.prefix ?? yellow("? "),
      indent: options.indent ?? "",
      keys: {
        submit: [
          "enter",
          "return"
        ],
        ...options.keys ?? {}
      }
    };
  }
  /** Execute the prompt. */ async prompt() {
    try {
      return await this.#execute();
    } finally{
      this.settings.tty.cursorShow();
    }
  }
  /** Clear prompt output. */ clear() {
    this.settings.tty.cursorLeft.eraseDown();
  }
  /** Execute the prompt. */ #execute = async ()=>{
    // Throw errors on unit tests.
    if (typeof GenericPrompt.injectedValue !== "undefined" && this.#lastError) {
      throw new Error(this.error());
    }
    await this.render();
    this.#lastError = undefined;
    if (!await this.read()) {
      return this.#execute();
    }
    if (typeof this.#value === "undefined") {
      throw new Error("internal error: failed to read value");
    }
    this.clear();
    const successMessage = this.success(this.#value);
    if (successMessage) {
      this.settings.writer.writeSync(this.#encoder.encode(successMessage + "\n"));
    }
    GenericPrompt.injectedValue = undefined;
    this.settings.tty.cursorShow();
    return this.#value;
  };
  /** Render prompt. */ async render() {
    const result = await Promise.all([
      this.message(),
      this.body?.(),
      this.footer()
    ]);
    const content = result.filter(Boolean).join("\n");
    const lines = content.split("\n");
    const columns = getColumns();
    const linesCount = columns ? lines.reduce((prev, next)=>{
      const length = stripColor(next).length;
      return prev + (length > columns ? Math.ceil(length / columns) : 1);
    }, 0) : content.split("\n").length;
    const y = linesCount - this.cursor.y - 1;
    if (!this.#isFirstRun || this.#lastError) {
      this.clear();
    }
    this.#isFirstRun = false;
    this.settings.writer.writeSync(this.#encoder.encode(content));
    if (y) {
      this.settings.tty.cursorUp(y);
    }
    this.settings.tty.cursorTo(this.cursor.x);
  }
  /** Read user input from stdin, handle events and validate user input. */ async read() {
    if (typeof GenericPrompt.injectedValue !== "undefined") {
      const value = GenericPrompt.injectedValue;
      await this.#validateValue(value);
    } else {
      const events = await this.#readKey();
      if (!events.length) {
        return false;
      }
      for (const event of events){
        await this.handleEvent(event);
      }
    }
    return typeof this.#value !== "undefined";
  }
  submit() {
    return this.#validateValue(this.getValue());
  }
  message() {
    return `${this.settings.indent}${this.settings.prefix}` + bold(this.settings.message) + this.defaults();
  }
  defaults() {
    let defaultMessage = "";
    if (typeof this.settings.default !== "undefined" && !this.settings.hideDefault) {
      defaultMessage += dim(` (${this.format(this.settings.default)})`);
    }
    return defaultMessage;
  }
  /** Get prompt success message. */ success(value) {
    return `${this.settings.indent}${this.settings.prefix}` + bold(this.settings.message) + this.defaults() + " " + this.settings.pointer + " " + green(this.format(value));
  }
  footer() {
    return this.error() ?? this.hint();
  }
  error() {
    return this.#lastError ? this.settings.indent + red(bold(`${Figures.CROSS} `) + this.#lastError) : undefined;
  }
  hint() {
    return this.settings.hint ? this.settings.indent + italic(brightBlue(dim(`${Figures.POINTER} `) + this.settings.hint)) : undefined;
  }
  setErrorMessage(message) {
    this.#lastError = message;
  }
  /**
   * Handle user input event.
   * @param event Key event.
   */ async handleEvent(event) {
    switch(true){
      case event.name === "c" && event.ctrl:
        this.clear();
        this.settings.tty.cursorShow();
        Deno.exit(130);
        return;
      case this.isKey(this.settings.keys, "submit", event):
        await this.submit();
        break;
    }
  }
  /** Read user input from stdin and pars ansi codes. */ #readKey = async ()=>{
    const data = await this.#readChar();
    return data.length ? parse(data) : [];
  };
  /** Read user input from stdin. */ #readChar = async ()=>{
    const buffer = new Uint8Array(8);
    const isTty = Deno.isatty(this.settings.reader.rid);
    if (isTty) {
      this.settings.reader.setRaw(true, {
        cbreak: this.settings.cbreak
      });
    }
    const nread = await this.settings.reader.read(buffer);
    if (isTty) {
      this.settings.reader.setRaw(false);
    }
    if (nread === null) {
      return buffer;
    }
    return buffer.subarray(0, nread);
  };
  /**
   * Map input value to output value. If a custom transform handler ist set, the
   * custom handler will be executed, otherwise the default transform handler
   * from the prompt will be executed.
   * @param value The value to transform.
   */ #transformValue = (value)=>{
    return this.settings.transform ? this.settings.transform(value) : this.transform(value);
  };
  /**
   * Validate input value. Set error message if validation fails and transform
   * output value on success.
   * If a default value is set, the default will be used as value without any
   * validation.
   * If a custom validation handler ist set, the custom handler will
   * be executed, otherwise a prompt specific default validation handler will be
   * executed.
   * @param value The value to validate.
   */ #validateValue = async (value)=>{
    if (!value && typeof this.settings.default !== "undefined") {
      this.#value = this.settings.default;
      return;
    }
    this.#value = undefined;
    this.#lastError = undefined;
    const validation = await (this.settings.validate ? this.settings.validate(value) : this.validate(value));
    if (validation === false) {
      this.#lastError = `Invalid answer.`;
    } else if (typeof validation === "string") {
      this.#lastError = validation;
    } else {
      this.#value = this.#transformValue(value);
    }
  };
  /**
   * Check if key event has given name or sequence.
   * @param keys  Key map.
   * @param name  Key name.
   * @param event Key event.
   */ isKey(keys, name, event) {
    // deno-lint-ignore no-explicit-any
    const keyNames = keys?.[name];
    return typeof keyNames !== "undefined" && (typeof event.name !== "undefined" && keyNames.indexOf(event.name) !== -1 || typeof event.sequence !== "undefined" && keyNames.indexOf(event.sequence) !== -1);
  }
}
function getColumns() {
  try {
    // Catch error in none tty mode: Inappropriate ioctl for device (os error 25)
    return Deno.consoleSize().columns ?? null;
  } catch (_error) {
    return null;
  }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImh0dHBzOi8vZGVuby5sYW5kL3gvY2xpZmZ5QHYxLjAuMC1yYy4zL3Byb21wdC9fZ2VuZXJpY19wcm9tcHQudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHR5cGUgeyBDdXJzb3IgfSBmcm9tIFwiLi4vYW5zaS9jdXJzb3JfcG9zaXRpb24udHNcIjtcbmltcG9ydCB7IFR0eSwgdHR5IH0gZnJvbSBcIi4uL2Fuc2kvdHR5LnRzXCI7XG5pbXBvcnQgeyBLZXlDb2RlLCBwYXJzZSB9IGZyb20gXCIuLi9rZXljb2RlL2tleV9jb2RlLnRzXCI7XG5pbXBvcnQge1xuICBib2xkLFxuICBicmlnaHRCbHVlLFxuICBkaW0sXG4gIGdyZWVuLFxuICBpdGFsaWMsXG4gIHJlZCxcbiAgc3RyaXBDb2xvcixcbiAgeWVsbG93LFxufSBmcm9tIFwiLi9kZXBzLnRzXCI7XG5pbXBvcnQgeyBGaWd1cmVzIH0gZnJvbSBcIi4vX2ZpZ3VyZXMudHNcIjtcblxuLyoqIFN0YXRpYyBnZW5lcmljIHByb21wdCBpbnRlcmZhY2UuICovXG5leHBvcnQgaW50ZXJmYWNlIFN0YXRpY0dlbmVyaWNQcm9tcHQ8VFZhbHVlLCBUT3B0aW9ucz4ge1xuICAvKipcbiAgICogSW5qZWN0IHByb21wdCB2YWx1ZS4gSWYgY2FsbGVkLCB0aGUgcHJvbXB0IGRvZXNuJ3QgcHJvbXB0IGZvciBhbiBpbnB1dCBhbmRcbiAgICogcmV0dXJucyBpbW1lZGlhdGVseSB0aGUgaW5qZWN0ZWQgdmFsdWUuIENhbiBiZSB1c2VkIGZvciB1bml0IHRlc3RzIG9yIHByZVxuICAgKiBzZWxlY3Rpb25zLlxuICAgKlxuICAgKiBAcGFyYW0gdmFsdWUgVGhlIGluamVjdGVkIHZhbHVlLlxuICAgKi9cbiAgaW5qZWN0Pyh2YWx1ZTogVFZhbHVlKTogdm9pZDtcblxuICAvKipcbiAgICogRXhlY3V0ZSB0aGUgcHJvbXB0IHdpdGggdGhlIGdpdmVuIG9wdGlvbnMuXG4gICAqXG4gICAqIEBwYXJhbSBvcHRpb25zIFByb21wdCBvcHRpb25zLlxuICAgKi9cbiAgcHJvbXB0KG9wdGlvbnM6IFRPcHRpb25zKTogUHJvbWlzZTxUVmFsdWU+O1xufVxuXG4vLyBkZW5vLWxpbnQtaWdub3JlIG5vLWV4cGxpY2l0LWFueVxuZXhwb3J0IHR5cGUgSW5mZXJQcm9tcHRPcHRpb25zPFRQcm9tcHQgZXh0ZW5kcyBHZW5lcmljUHJvbXB0PGFueSwgYW55Pj4gPVxuICBQYXJhbWV0ZXJzPFxuICAgIFRQcm9tcHRbXCJnZXREZWZhdWx0U2V0dGluZ3NcIl1cbiAgPlswXTtcblxuLy8gZGVuby1saW50LWlnbm9yZSBuby1leHBsaWNpdC1hbnlcbmV4cG9ydCB0eXBlIEluZmVyUHJvbXB0VmFsdWU8VFByb21wdCBleHRlbmRzIEdlbmVyaWNQcm9tcHQ8YW55LCBhbnk+PiA9IEF3YWl0ZWQ8XG4gIFJldHVyblR5cGU8XG4gICAgVFByb21wdFtcInByb21wdFwiXVxuICA+XG4+O1xuXG4vKiogR2VuZXJpYyBwcm9tcHQgb3B0aW9ucy4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgR2VuZXJpY1Byb21wdE9wdGlvbnM8VFZhbHVlLCBUUmF3VmFsdWU+IHtcbiAgLyoqIFRoZSBwcm9tcHQgbWVzc2FnZS4gKi9cbiAgbWVzc2FnZTogc3RyaW5nO1xuICAvKiogVGhlIGRlZmF1bHQgdmFsdWUgb2YgdGhlIHByb21wdC4gKi9cbiAgZGVmYXVsdD86IFRWYWx1ZTtcbiAgLyoqIERvbid0IHNob3cgdGhlIGRlZmF1bHQgdmFsdWUgYWZ0ZXIgdGhlIHByb21wdCBtZXNzYWdlLiAqL1xuICBoaWRlRGVmYXVsdD86IGJvb2xlYW47XG4gIC8qKiBWYWxpZGF0ZSBwcm9tcHQgdmFsdWUuICovXG4gIHZhbGlkYXRlPzogKHZhbHVlOiBUUmF3VmFsdWUpID0+IFZhbGlkYXRlUmVzdWx0O1xuICAvKiogVHJhbnNmb3JtIGlucHV0IHZhbHVlIHRvIG91dHB1dCB2YWx1ZS4gKi9cbiAgdHJhbnNmb3JtPzogKHZhbHVlOiBUUmF3VmFsdWUpID0+IFRWYWx1ZSB8IHVuZGVmaW5lZDtcbiAgLyoqIFNob3cgYSBoaW50IGJlbG93IHRoZSBwcm9tcHQuICovXG4gIGhpbnQ/OiBzdHJpbmc7XG4gIC8qKiBDaGFuZ2UgdGhlIHByb21wdCBwb2ludGVyLiBEZWZhdWx0IGlzIGBicmlnaHRCbHVlKFwi4oC6XCIpYC4gKi9cbiAgcG9pbnRlcj86IHN0cmluZztcbiAgLyoqIEluZGVudCB0aGUgcHJvbXB0LiAqL1xuICBpbmRlbnQ/OiBzdHJpbmc7XG4gIC8qKiBLZXltYXAgdG8gYXNzaWduIGtleSBuYW1lcyB0byBwcm9tcHQgYWN0aW9ucy4gKi9cbiAga2V5cz86IEdlbmVyaWNQcm9tcHRLZXlzO1xuICAvKiogRW5hYmxlIGNicmVhayBtb2RlLiBGb3IgbW9yZSBpbmZvcm1hdGlvbiBzZWUgW0Rlbm8uU2V0UmF3T3B0aW9uc10oaHR0cHM6Ly9kZW5vLmxhbmQvYXBpQHYxLjM1LjM/cz1EZW5vLlNldFJhd09wdGlvbnMpLiAqL1xuICBjYnJlYWs/OiBib29sZWFuO1xuICAvKiogQ2hhbmdlIHRoZSBwcm9tcHQgcHJlZml4LiBEZWZhdWx0IGlzOiBgeWVsbG93KFwiPyBcIilgLiAqL1xuICBwcmVmaXg/OiBzdHJpbmc7XG4gIC8qKiBDaGFuZ2UgdGhlIHByb21wdCBpbnB1dCBzdHJlYW0uICovXG4gIHJlYWRlcj86IERlbm8uUmVhZGVyICYge1xuICAgIHJlYWRvbmx5IHJpZDogbnVtYmVyO1xuICAgIHNldFJhdyhtb2RlOiBib29sZWFuLCBvcHRpb25zPzogRGVuby5TZXRSYXdPcHRpb25zKTogdm9pZDtcbiAgfTtcbiAgLyoqIENoYW5nZSB0aGUgcHJvbXB0IG91dHB1dCBzdHJlYW0uICovXG4gIHdyaXRlcj86IERlbm8uV3JpdGVyU3luYztcbn1cblxuLyoqIEdlbmVyaWMgcHJvbXB0IHNldHRpbmdzLiAqL1xuZXhwb3J0IGludGVyZmFjZSBHZW5lcmljUHJvbXB0U2V0dGluZ3M8VFZhbHVlLCBUUmF3VmFsdWU+XG4gIGV4dGVuZHMgR2VuZXJpY1Byb21wdE9wdGlvbnM8VFZhbHVlLCBUUmF3VmFsdWU+IHtcbiAgcG9pbnRlcjogc3RyaW5nO1xuICBpbmRlbnQ6IHN0cmluZztcbiAgcHJlZml4OiBzdHJpbmc7XG4gIGNicmVhazogYm9vbGVhbjtcbiAgdHR5OiBUdHk7XG4gIHJlYWRlcjogRGVuby5SZWFkZXIgJiB7XG4gICAgcmVhZG9ubHkgcmlkOiBudW1iZXI7XG4gICAgc2V0UmF3KG1vZGU6IGJvb2xlYW4sIG9wdGlvbnM/OiBEZW5vLlNldFJhd09wdGlvbnMpOiB2b2lkO1xuICB9O1xuICB3cml0ZXI6IERlbm8uV3JpdGVyU3luYztcbn1cblxuLyoqIFByb21wdCB2YWxpZGF0aW9uIHJldHVybiB0YXBlLiAqL1xuZXhwb3J0IHR5cGUgVmFsaWRhdGVSZXN1bHQgPSBzdHJpbmcgfCBib29sZWFuIHwgUHJvbWlzZTxzdHJpbmcgfCBib29sZWFuPjtcblxuLyoqIEdlbmVyaWMgcHJvbXB0IGtleW1hcC4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgR2VuZXJpY1Byb21wdEtleXMge1xuICAvKiogU3VibWl0IGtleW1hcC4gRGVmYXVsdCBpcyBgW1wiZW50ZXJcIiwgXCJyZXR1cm5cIl1gLiAqL1xuICBzdWJtaXQ/OiBBcnJheTxzdHJpbmc+O1xufVxuXG4vKiogR2VuZXJpYyBwcm9tcHQgcmVwcmVzZW50YXRpb24uICovXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgR2VuZXJpY1Byb21wdDxcbiAgVFZhbHVlLFxuICBUUmF3VmFsdWUsXG4+IHtcbiAgcHJvdGVjdGVkIHN0YXRpYyBpbmplY3RlZFZhbHVlOiB1bmtub3duIHwgdW5kZWZpbmVkO1xuICBwcm90ZWN0ZWQgYWJzdHJhY3QgcmVhZG9ubHkgc2V0dGluZ3M6IEdlbmVyaWNQcm9tcHRTZXR0aW5nczxcbiAgICBUVmFsdWUsXG4gICAgVFJhd1ZhbHVlXG4gID47XG4gIHByb3RlY3RlZCByZWFkb25seSBjdXJzb3I6IEN1cnNvciA9IHtcbiAgICB4OiAwLFxuICAgIHk6IDAsXG4gIH07XG4gICN2YWx1ZTogVFZhbHVlIHwgdW5kZWZpbmVkO1xuICAjbGFzdEVycm9yOiBzdHJpbmcgfCB1bmRlZmluZWQ7XG4gICNpc0ZpcnN0UnVuID0gdHJ1ZTtcbiAgI2VuY29kZXIgPSBuZXcgVGV4dEVuY29kZXIoKTtcblxuICAvKipcbiAgICogSW5qZWN0IHByb21wdCB2YWx1ZS4gSWYgY2FsbGVkLCB0aGUgcHJvbXB0IGRvZXNuJ3QgcHJvbXB0IGZvciBhbiBpbnB1dCBhbmRcbiAgICogcmV0dXJucyBpbW1lZGlhdGVseSB0aGUgaW5qZWN0ZWQgdmFsdWUuIENhbiBiZSB1c2VkIGZvciB1bml0IHRlc3RzIG9yIHByZVxuICAgKiBzZWxlY3Rpb25zLlxuICAgKlxuICAgKiBAcGFyYW0gdmFsdWUgSW5wdXQgdmFsdWUuXG4gICAqL1xuICBwdWJsaWMgc3RhdGljIGluamVjdCh2YWx1ZTogdW5rbm93bik6IHZvaWQge1xuICAgIEdlbmVyaWNQcm9tcHQuaW5qZWN0ZWRWYWx1ZSA9IHZhbHVlO1xuICB9XG5cbiAgcHVibGljIGdldERlZmF1bHRTZXR0aW5ncyhcbiAgICBvcHRpb25zOiBHZW5lcmljUHJvbXB0T3B0aW9uczxUVmFsdWUsIFRSYXdWYWx1ZT4sXG4gICk6IEdlbmVyaWNQcm9tcHRTZXR0aW5nczxUVmFsdWUsIFRSYXdWYWx1ZT4ge1xuICAgIHJldHVybiB7XG4gICAgICAuLi5vcHRpb25zLFxuICAgICAgdHR5OiB0dHkoe1xuICAgICAgICAvLyBTdGRpbiBpcyBvbmx5IHVzZWQgYnkgZ2V0Q3Vyc29yUG9zaXRpb24gd2hpY2ggd2UgZG9uJ3QgbmVlZC5cbiAgICAgICAgcmVhZGVyOiBEZW5vLnN0ZGluLFxuICAgICAgICB3cml0ZXI6IG9wdGlvbnMud3JpdGVyID8/IERlbm8uc3Rkb3V0LFxuICAgICAgfSksXG4gICAgICBjYnJlYWs6IG9wdGlvbnMuY2JyZWFrID8/IGZhbHNlLFxuICAgICAgcmVhZGVyOiBvcHRpb25zLnJlYWRlciA/PyBEZW5vLnN0ZGluLFxuICAgICAgd3JpdGVyOiBvcHRpb25zLndyaXRlciA/PyBEZW5vLnN0ZG91dCxcbiAgICAgIHBvaW50ZXI6IG9wdGlvbnMucG9pbnRlciA/PyBicmlnaHRCbHVlKEZpZ3VyZXMuUE9JTlRFUl9TTUFMTCksXG4gICAgICBwcmVmaXg6IG9wdGlvbnMucHJlZml4ID8/IHllbGxvdyhcIj8gXCIpLFxuICAgICAgaW5kZW50OiBvcHRpb25zLmluZGVudCA/PyBcIlwiLFxuICAgICAga2V5czoge1xuICAgICAgICBzdWJtaXQ6IFtcImVudGVyXCIsIFwicmV0dXJuXCJdLFxuICAgICAgICAuLi4ob3B0aW9ucy5rZXlzID8/IHt9KSxcbiAgICAgIH0sXG4gICAgfTtcbiAgfVxuXG4gIC8qKiBFeGVjdXRlIHRoZSBwcm9tcHQuICovXG4gIHB1YmxpYyBhc3luYyBwcm9tcHQoKTogUHJvbWlzZTxUVmFsdWU+IHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuI2V4ZWN1dGUoKTtcbiAgICB9IGZpbmFsbHkge1xuICAgICAgdGhpcy5zZXR0aW5ncy50dHkuY3Vyc29yU2hvdygpO1xuICAgIH1cbiAgfVxuXG4gIC8qKiBDbGVhciBwcm9tcHQgb3V0cHV0LiAqL1xuICBwcm90ZWN0ZWQgY2xlYXIoKTogdm9pZCB7XG4gICAgdGhpcy5zZXR0aW5ncy50dHkuY3Vyc29yTGVmdC5lcmFzZURvd24oKTtcbiAgfVxuXG4gIC8qKiBFeGVjdXRlIHRoZSBwcm9tcHQuICovXG4gICNleGVjdXRlID0gYXN5bmMgKCk6IFByb21pc2U8VFZhbHVlPiA9PiB7XG4gICAgLy8gVGhyb3cgZXJyb3JzIG9uIHVuaXQgdGVzdHMuXG4gICAgaWYgKHR5cGVvZiBHZW5lcmljUHJvbXB0LmluamVjdGVkVmFsdWUgIT09IFwidW5kZWZpbmVkXCIgJiYgdGhpcy4jbGFzdEVycm9yKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IodGhpcy5lcnJvcigpKTtcbiAgICB9XG5cbiAgICBhd2FpdCB0aGlzLnJlbmRlcigpO1xuICAgIHRoaXMuI2xhc3RFcnJvciA9IHVuZGVmaW5lZDtcblxuICAgIGlmICghYXdhaXQgdGhpcy5yZWFkKCkpIHtcbiAgICAgIHJldHVybiB0aGlzLiNleGVjdXRlKCk7XG4gICAgfVxuXG4gICAgaWYgKHR5cGVvZiB0aGlzLiN2YWx1ZSA9PT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiaW50ZXJuYWwgZXJyb3I6IGZhaWxlZCB0byByZWFkIHZhbHVlXCIpO1xuICAgIH1cblxuICAgIHRoaXMuY2xlYXIoKTtcbiAgICBjb25zdCBzdWNjZXNzTWVzc2FnZTogc3RyaW5nIHwgdW5kZWZpbmVkID0gdGhpcy5zdWNjZXNzKHRoaXMuI3ZhbHVlKTtcblxuICAgIGlmIChzdWNjZXNzTWVzc2FnZSkge1xuICAgICAgdGhpcy5zZXR0aW5ncy53cml0ZXIud3JpdGVTeW5jKFxuICAgICAgICB0aGlzLiNlbmNvZGVyLmVuY29kZShzdWNjZXNzTWVzc2FnZSArIFwiXFxuXCIpLFxuICAgICAgKTtcbiAgICB9XG5cbiAgICBHZW5lcmljUHJvbXB0LmluamVjdGVkVmFsdWUgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5zZXR0aW5ncy50dHkuY3Vyc29yU2hvdygpO1xuXG4gICAgcmV0dXJuIHRoaXMuI3ZhbHVlO1xuICB9O1xuXG4gIC8qKiBSZW5kZXIgcHJvbXB0LiAqL1xuICBwcm90ZWN0ZWQgYXN5bmMgcmVuZGVyKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IHJlc3VsdDogW3N0cmluZywgc3RyaW5nIHwgdW5kZWZpbmVkLCBzdHJpbmcgfCB1bmRlZmluZWRdID1cbiAgICAgIGF3YWl0IFByb21pc2UuYWxsKFtcbiAgICAgICAgdGhpcy5tZXNzYWdlKCksXG4gICAgICAgIHRoaXMuYm9keT8uKCksXG4gICAgICAgIHRoaXMuZm9vdGVyKCksXG4gICAgICBdKTtcblxuICAgIGNvbnN0IGNvbnRlbnQ6IHN0cmluZyA9IHJlc3VsdC5maWx0ZXIoQm9vbGVhbikuam9pbihcIlxcblwiKTtcbiAgICBjb25zdCBsaW5lcyA9IGNvbnRlbnQuc3BsaXQoXCJcXG5cIik7XG5cbiAgICBjb25zdCBjb2x1bW5zID0gZ2V0Q29sdW1ucygpO1xuICAgIGNvbnN0IGxpbmVzQ291bnQ6IG51bWJlciA9IGNvbHVtbnNcbiAgICAgID8gbGluZXMucmVkdWNlKChwcmV2LCBuZXh0KSA9PiB7XG4gICAgICAgIGNvbnN0IGxlbmd0aCA9IHN0cmlwQ29sb3IobmV4dCkubGVuZ3RoO1xuICAgICAgICByZXR1cm4gcHJldiArIChsZW5ndGggPiBjb2x1bW5zID8gTWF0aC5jZWlsKGxlbmd0aCAvIGNvbHVtbnMpIDogMSk7XG4gICAgICB9LCAwKVxuICAgICAgOiBjb250ZW50LnNwbGl0KFwiXFxuXCIpLmxlbmd0aDtcblxuICAgIGNvbnN0IHk6IG51bWJlciA9IGxpbmVzQ291bnQgLSB0aGlzLmN1cnNvci55IC0gMTtcblxuICAgIGlmICghdGhpcy4jaXNGaXJzdFJ1biB8fCB0aGlzLiNsYXN0RXJyb3IpIHtcbiAgICAgIHRoaXMuY2xlYXIoKTtcbiAgICB9XG4gICAgdGhpcy4jaXNGaXJzdFJ1biA9IGZhbHNlO1xuICAgIHRoaXMuc2V0dGluZ3Mud3JpdGVyLndyaXRlU3luYyh0aGlzLiNlbmNvZGVyLmVuY29kZShjb250ZW50KSk7XG5cbiAgICBpZiAoeSkge1xuICAgICAgdGhpcy5zZXR0aW5ncy50dHkuY3Vyc29yVXAoeSk7XG4gICAgfVxuICAgIHRoaXMuc2V0dGluZ3MudHR5LmN1cnNvclRvKHRoaXMuY3Vyc29yLngpO1xuICB9XG5cbiAgLyoqIFJlYWQgdXNlciBpbnB1dCBmcm9tIHN0ZGluLCBoYW5kbGUgZXZlbnRzIGFuZCB2YWxpZGF0ZSB1c2VyIGlucHV0LiAqL1xuICBwcm90ZWN0ZWQgYXN5bmMgcmVhZCgpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICBpZiAodHlwZW9mIEdlbmVyaWNQcm9tcHQuaW5qZWN0ZWRWYWx1ZSAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgY29uc3QgdmFsdWU6IFRSYXdWYWx1ZSA9IEdlbmVyaWNQcm9tcHQuaW5qZWN0ZWRWYWx1ZSBhcyBUUmF3VmFsdWU7XG4gICAgICBhd2FpdCB0aGlzLiN2YWxpZGF0ZVZhbHVlKHZhbHVlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgZXZlbnRzOiBBcnJheTxLZXlDb2RlPiA9IGF3YWl0IHRoaXMuI3JlYWRLZXkoKTtcblxuICAgICAgaWYgKCFldmVudHMubGVuZ3RoKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cblxuICAgICAgZm9yIChjb25zdCBldmVudCBvZiBldmVudHMpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5oYW5kbGVFdmVudChldmVudCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHR5cGVvZiB0aGlzLiN2YWx1ZSAhPT0gXCJ1bmRlZmluZWRcIjtcbiAgfVxuXG4gIHByb3RlY3RlZCBzdWJtaXQoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgcmV0dXJuIHRoaXMuI3ZhbGlkYXRlVmFsdWUodGhpcy5nZXRWYWx1ZSgpKTtcbiAgfVxuXG4gIHByb3RlY3RlZCBtZXNzYWdlKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIGAke3RoaXMuc2V0dGluZ3MuaW5kZW50fSR7dGhpcy5zZXR0aW5ncy5wcmVmaXh9YCArXG4gICAgICBib2xkKHRoaXMuc2V0dGluZ3MubWVzc2FnZSkgKyB0aGlzLmRlZmF1bHRzKCk7XG4gIH1cblxuICBwcm90ZWN0ZWQgZGVmYXVsdHMoKTogc3RyaW5nIHtcbiAgICBsZXQgZGVmYXVsdE1lc3NhZ2UgPSBcIlwiO1xuICAgIGlmIChcbiAgICAgIHR5cGVvZiB0aGlzLnNldHRpbmdzLmRlZmF1bHQgIT09IFwidW5kZWZpbmVkXCIgJiYgIXRoaXMuc2V0dGluZ3MuaGlkZURlZmF1bHRcbiAgICApIHtcbiAgICAgIGRlZmF1bHRNZXNzYWdlICs9IGRpbShgICgke3RoaXMuZm9ybWF0KHRoaXMuc2V0dGluZ3MuZGVmYXVsdCl9KWApO1xuICAgIH1cbiAgICByZXR1cm4gZGVmYXVsdE1lc3NhZ2U7XG4gIH1cblxuICAvKiogR2V0IHByb21wdCBzdWNjZXNzIG1lc3NhZ2UuICovXG4gIHByb3RlY3RlZCBzdWNjZXNzKHZhbHVlOiBUVmFsdWUpOiBzdHJpbmcgfCB1bmRlZmluZWQge1xuICAgIHJldHVybiBgJHt0aGlzLnNldHRpbmdzLmluZGVudH0ke3RoaXMuc2V0dGluZ3MucHJlZml4fWAgK1xuICAgICAgYm9sZCh0aGlzLnNldHRpbmdzLm1lc3NhZ2UpICsgdGhpcy5kZWZhdWx0cygpICtcbiAgICAgIFwiIFwiICsgdGhpcy5zZXR0aW5ncy5wb2ludGVyICtcbiAgICAgIFwiIFwiICsgZ3JlZW4odGhpcy5mb3JtYXQodmFsdWUpKTtcbiAgfVxuXG4gIHByb3RlY3RlZCBib2R5PygpOiBzdHJpbmcgfCB1bmRlZmluZWQgfCBQcm9taXNlPHN0cmluZyB8IHVuZGVmaW5lZD47XG5cbiAgcHJvdGVjdGVkIGZvb3RlcigpOiBzdHJpbmcgfCB1bmRlZmluZWQge1xuICAgIHJldHVybiB0aGlzLmVycm9yKCkgPz8gdGhpcy5oaW50KCk7XG4gIH1cblxuICBwcm90ZWN0ZWQgZXJyb3IoKTogc3RyaW5nIHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy4jbGFzdEVycm9yXG4gICAgICA/IHRoaXMuc2V0dGluZ3MuaW5kZW50ICsgcmVkKGJvbGQoYCR7RmlndXJlcy5DUk9TU30gYCkgKyB0aGlzLiNsYXN0RXJyb3IpXG4gICAgICA6IHVuZGVmaW5lZDtcbiAgfVxuXG4gIHByb3RlY3RlZCBoaW50KCk6IHN0cmluZyB8IHVuZGVmaW5lZCB7XG4gICAgcmV0dXJuIHRoaXMuc2V0dGluZ3MuaGludFxuICAgICAgPyB0aGlzLnNldHRpbmdzLmluZGVudCArXG4gICAgICAgIGl0YWxpYyhicmlnaHRCbHVlKGRpbShgJHtGaWd1cmVzLlBPSU5URVJ9IGApICsgdGhpcy5zZXR0aW5ncy5oaW50KSlcbiAgICAgIDogdW5kZWZpbmVkO1xuICB9XG5cbiAgcHJvdGVjdGVkIHNldEVycm9yTWVzc2FnZShtZXNzYWdlOiBzdHJpbmcpIHtcbiAgICB0aGlzLiNsYXN0RXJyb3IgPSBtZXNzYWdlO1xuICB9XG5cbiAgLyoqXG4gICAqIEhhbmRsZSB1c2VyIGlucHV0IGV2ZW50LlxuICAgKiBAcGFyYW0gZXZlbnQgS2V5IGV2ZW50LlxuICAgKi9cbiAgcHJvdGVjdGVkIGFzeW5jIGhhbmRsZUV2ZW50KGV2ZW50OiBLZXlDb2RlKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgc3dpdGNoICh0cnVlKSB7XG4gICAgICBjYXNlIGV2ZW50Lm5hbWUgPT09IFwiY1wiICYmIGV2ZW50LmN0cmw6XG4gICAgICAgIHRoaXMuY2xlYXIoKTtcbiAgICAgICAgdGhpcy5zZXR0aW5ncy50dHkuY3Vyc29yU2hvdygpO1xuICAgICAgICBEZW5vLmV4aXQoMTMwKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgY2FzZSB0aGlzLmlzS2V5KHRoaXMuc2V0dGluZ3Mua2V5cywgXCJzdWJtaXRcIiwgZXZlbnQpOlxuICAgICAgICBhd2FpdCB0aGlzLnN1Ym1pdCgpO1xuICAgICAgICBicmVhaztcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogTWFwIGlucHV0IHZhbHVlIHRvIG91dHB1dCB2YWx1ZS5cbiAgICogQHBhcmFtIHZhbHVlIElucHV0IHZhbHVlLlxuICAgKiBAcmV0dXJuIE91dHB1dCB2YWx1ZS5cbiAgICovXG4gIHByb3RlY3RlZCBhYnN0cmFjdCB0cmFuc2Zvcm0odmFsdWU6IFRSYXdWYWx1ZSk6IFRWYWx1ZSB8IHVuZGVmaW5lZDtcblxuICAvKipcbiAgICogVmFsaWRhdGUgaW5wdXQgdmFsdWUuXG4gICAqIEBwYXJhbSB2YWx1ZSBVc2VyIGlucHV0IHZhbHVlLlxuICAgKiBAcmV0dXJuIFRydWUgb24gc3VjY2VzcywgZmFsc2Ugb3IgZXJyb3IgbWVzc2FnZSBvbiBlcnJvci5cbiAgICovXG4gIHByb3RlY3RlZCBhYnN0cmFjdCB2YWxpZGF0ZSh2YWx1ZTogVFJhd1ZhbHVlKTogVmFsaWRhdGVSZXN1bHQ7XG5cbiAgLyoqXG4gICAqIEZvcm1hdCBvdXRwdXQgdmFsdWUuXG4gICAqIEBwYXJhbSB2YWx1ZSBPdXRwdXQgdmFsdWUuXG4gICAqL1xuICBwcm90ZWN0ZWQgYWJzdHJhY3QgZm9ybWF0KHZhbHVlOiBUVmFsdWUpOiBzdHJpbmc7XG5cbiAgLyoqIEdldCBpbnB1dCB2YWx1ZS4gKi9cbiAgcHJvdGVjdGVkIGFic3RyYWN0IGdldFZhbHVlKCk6IFRSYXdWYWx1ZTtcblxuICAvKiogUmVhZCB1c2VyIGlucHV0IGZyb20gc3RkaW4gYW5kIHBhcnMgYW5zaSBjb2Rlcy4gKi9cbiAgI3JlYWRLZXkgPSBhc3luYyAoKTogUHJvbWlzZTxBcnJheTxLZXlDb2RlPj4gPT4ge1xuICAgIGNvbnN0IGRhdGE6IFVpbnQ4QXJyYXkgPSBhd2FpdCB0aGlzLiNyZWFkQ2hhcigpO1xuXG4gICAgcmV0dXJuIGRhdGEubGVuZ3RoID8gcGFyc2UoZGF0YSkgOiBbXTtcbiAgfTtcblxuICAvKiogUmVhZCB1c2VyIGlucHV0IGZyb20gc3RkaW4uICovXG4gICNyZWFkQ2hhciA9IGFzeW5jICgpOiBQcm9taXNlPFVpbnQ4QXJyYXk+ID0+IHtcbiAgICBjb25zdCBidWZmZXIgPSBuZXcgVWludDhBcnJheSg4KTtcbiAgICBjb25zdCBpc1R0eSA9IERlbm8uaXNhdHR5KHRoaXMuc2V0dGluZ3MucmVhZGVyLnJpZCk7XG5cbiAgICBpZiAoaXNUdHkpIHtcbiAgICAgIHRoaXMuc2V0dGluZ3MucmVhZGVyLnNldFJhdyhcbiAgICAgICAgdHJ1ZSxcbiAgICAgICAgeyBjYnJlYWs6IHRoaXMuc2V0dGluZ3MuY2JyZWFrIH0sXG4gICAgICApO1xuICAgIH1cbiAgICBjb25zdCBucmVhZDogbnVtYmVyIHwgbnVsbCA9IGF3YWl0IHRoaXMuc2V0dGluZ3MucmVhZGVyLnJlYWQoYnVmZmVyKTtcblxuICAgIGlmIChpc1R0eSkge1xuICAgICAgdGhpcy5zZXR0aW5ncy5yZWFkZXIuc2V0UmF3KGZhbHNlKTtcbiAgICB9XG5cbiAgICBpZiAobnJlYWQgPT09IG51bGwpIHtcbiAgICAgIHJldHVybiBidWZmZXI7XG4gICAgfVxuXG4gICAgcmV0dXJuIGJ1ZmZlci5zdWJhcnJheSgwLCBucmVhZCk7XG4gIH07XG5cbiAgLyoqXG4gICAqIE1hcCBpbnB1dCB2YWx1ZSB0byBvdXRwdXQgdmFsdWUuIElmIGEgY3VzdG9tIHRyYW5zZm9ybSBoYW5kbGVyIGlzdCBzZXQsIHRoZVxuICAgKiBjdXN0b20gaGFuZGxlciB3aWxsIGJlIGV4ZWN1dGVkLCBvdGhlcndpc2UgdGhlIGRlZmF1bHQgdHJhbnNmb3JtIGhhbmRsZXJcbiAgICogZnJvbSB0aGUgcHJvbXB0IHdpbGwgYmUgZXhlY3V0ZWQuXG4gICAqIEBwYXJhbSB2YWx1ZSBUaGUgdmFsdWUgdG8gdHJhbnNmb3JtLlxuICAgKi9cbiAgI3RyYW5zZm9ybVZhbHVlID0gKHZhbHVlOiBUUmF3VmFsdWUpOiBUVmFsdWUgfCB1bmRlZmluZWQgPT4ge1xuICAgIHJldHVybiB0aGlzLnNldHRpbmdzLnRyYW5zZm9ybVxuICAgICAgPyB0aGlzLnNldHRpbmdzLnRyYW5zZm9ybSh2YWx1ZSlcbiAgICAgIDogdGhpcy50cmFuc2Zvcm0odmFsdWUpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBWYWxpZGF0ZSBpbnB1dCB2YWx1ZS4gU2V0IGVycm9yIG1lc3NhZ2UgaWYgdmFsaWRhdGlvbiBmYWlscyBhbmQgdHJhbnNmb3JtXG4gICAqIG91dHB1dCB2YWx1ZSBvbiBzdWNjZXNzLlxuICAgKiBJZiBhIGRlZmF1bHQgdmFsdWUgaXMgc2V0LCB0aGUgZGVmYXVsdCB3aWxsIGJlIHVzZWQgYXMgdmFsdWUgd2l0aG91dCBhbnlcbiAgICogdmFsaWRhdGlvbi5cbiAgICogSWYgYSBjdXN0b20gdmFsaWRhdGlvbiBoYW5kbGVyIGlzdCBzZXQsIHRoZSBjdXN0b20gaGFuZGxlciB3aWxsXG4gICAqIGJlIGV4ZWN1dGVkLCBvdGhlcndpc2UgYSBwcm9tcHQgc3BlY2lmaWMgZGVmYXVsdCB2YWxpZGF0aW9uIGhhbmRsZXIgd2lsbCBiZVxuICAgKiBleGVjdXRlZC5cbiAgICogQHBhcmFtIHZhbHVlIFRoZSB2YWx1ZSB0byB2YWxpZGF0ZS5cbiAgICovXG4gICN2YWxpZGF0ZVZhbHVlID0gYXN5bmMgKHZhbHVlOiBUUmF3VmFsdWUpOiBQcm9taXNlPHZvaWQ+ID0+IHtcbiAgICBpZiAoIXZhbHVlICYmIHR5cGVvZiB0aGlzLnNldHRpbmdzLmRlZmF1bHQgIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgIHRoaXMuI3ZhbHVlID0gdGhpcy5zZXR0aW5ncy5kZWZhdWx0O1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuI3ZhbHVlID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuI2xhc3RFcnJvciA9IHVuZGVmaW5lZDtcblxuICAgIGNvbnN0IHZhbGlkYXRpb24gPVxuICAgICAgYXdhaXQgKHRoaXMuc2V0dGluZ3MudmFsaWRhdGVcbiAgICAgICAgPyB0aGlzLnNldHRpbmdzLnZhbGlkYXRlKHZhbHVlKVxuICAgICAgICA6IHRoaXMudmFsaWRhdGUodmFsdWUpKTtcblxuICAgIGlmICh2YWxpZGF0aW9uID09PSBmYWxzZSkge1xuICAgICAgdGhpcy4jbGFzdEVycm9yID0gYEludmFsaWQgYW5zd2VyLmA7XG4gICAgfSBlbHNlIGlmICh0eXBlb2YgdmFsaWRhdGlvbiA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgdGhpcy4jbGFzdEVycm9yID0gdmFsaWRhdGlvbjtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy4jdmFsdWUgPSB0aGlzLiN0cmFuc2Zvcm1WYWx1ZSh2YWx1ZSk7XG4gICAgfVxuICB9O1xuXG4gIC8qKlxuICAgKiBDaGVjayBpZiBrZXkgZXZlbnQgaGFzIGdpdmVuIG5hbWUgb3Igc2VxdWVuY2UuXG4gICAqIEBwYXJhbSBrZXlzICBLZXkgbWFwLlxuICAgKiBAcGFyYW0gbmFtZSAgS2V5IG5hbWUuXG4gICAqIEBwYXJhbSBldmVudCBLZXkgZXZlbnQuXG4gICAqL1xuICBwcm90ZWN0ZWQgaXNLZXk8VEtleSBleHRlbmRzIHVua25vd24sIFROYW1lIGV4dGVuZHMga2V5b2YgVEtleT4oXG4gICAga2V5czogVEtleSB8IHVuZGVmaW5lZCxcbiAgICBuYW1lOiBUTmFtZSxcbiAgICBldmVudDogS2V5Q29kZSxcbiAgKTogYm9vbGVhbiB7XG4gICAgLy8gZGVuby1saW50LWlnbm9yZSBuby1leHBsaWNpdC1hbnlcbiAgICBjb25zdCBrZXlOYW1lczogQXJyYXk8dW5rbm93bj4gfCB1bmRlZmluZWQgPSBrZXlzPy5bbmFtZV0gYXMgYW55O1xuICAgIHJldHVybiB0eXBlb2Yga2V5TmFtZXMgIT09IFwidW5kZWZpbmVkXCIgJiYgKFxuICAgICAgKHR5cGVvZiBldmVudC5uYW1lICE9PSBcInVuZGVmaW5lZFwiICYmXG4gICAgICAgIGtleU5hbWVzLmluZGV4T2YoZXZlbnQubmFtZSkgIT09IC0xKSB8fFxuICAgICAgKHR5cGVvZiBldmVudC5zZXF1ZW5jZSAhPT0gXCJ1bmRlZmluZWRcIiAmJlxuICAgICAgICBrZXlOYW1lcy5pbmRleE9mKGV2ZW50LnNlcXVlbmNlKSAhPT0gLTEpXG4gICAgKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBnZXRDb2x1bW5zKCk6IG51bWJlciB8IG51bGwge1xuICB0cnkge1xuICAgIC8vIENhdGNoIGVycm9yIGluIG5vbmUgdHR5IG1vZGU6IEluYXBwcm9wcmlhdGUgaW9jdGwgZm9yIGRldmljZSAob3MgZXJyb3IgMjUpXG4gICAgcmV0dXJuIERlbm8uY29uc29sZVNpemUoKS5jb2x1bW5zID8/IG51bGw7XG4gIH0gY2F0Y2ggKF9lcnJvcikge1xuICAgIHJldHVybiBudWxsO1xuICB9XG59XG4iXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsU0FBYyxHQUFHLFFBQVEsaUJBQWlCO0FBQzFDLFNBQWtCLEtBQUssUUFBUSx5QkFBeUI7QUFDeEQsU0FDRSxJQUFJLEVBQ0osVUFBVSxFQUNWLEdBQUcsRUFDSCxLQUFLLEVBQ0wsTUFBTSxFQUNOLEdBQUcsRUFDSCxVQUFVLEVBQ1YsTUFBTSxRQUNELFlBQVk7QUFDbkIsU0FBUyxPQUFPLFFBQVEsZ0JBQWdCO0FBMkZ4QyxtQ0FBbUMsR0FDbkMsT0FBTyxNQUFlO0VBSXBCLE9BQWlCLGNBQW1DO0VBS2pDLFNBQWlCO0lBQ2xDLEdBQUc7SUFDSCxHQUFHO0VBQ0wsRUFBRTtFQUNGLENBQUEsS0FBTSxDQUFxQjtFQUMzQixDQUFBLFNBQVUsQ0FBcUI7RUFDL0IsQ0FBQSxVQUFXLEdBQUcsS0FBSztFQUNuQixDQUFBLE9BQVEsR0FBRyxJQUFJLGNBQWM7RUFFN0I7Ozs7OztHQU1DLEdBQ0QsT0FBYyxPQUFPLEtBQWMsRUFBUTtJQUN6QyxjQUFjLGFBQWEsR0FBRztFQUNoQztFQUVPLG1CQUNMLE9BQWdELEVBQ047SUFDMUMsT0FBTztNQUNMLEdBQUcsT0FBTztNQUNWLEtBQUssSUFBSTtRQUNQLCtEQUErRDtRQUMvRCxRQUFRLEtBQUssS0FBSztRQUNsQixRQUFRLFFBQVEsTUFBTSxJQUFJLEtBQUssTUFBTTtNQUN2QztNQUNBLFFBQVEsUUFBUSxNQUFNLElBQUk7TUFDMUIsUUFBUSxRQUFRLE1BQU0sSUFBSSxLQUFLLEtBQUs7TUFDcEMsUUFBUSxRQUFRLE1BQU0sSUFBSSxLQUFLLE1BQU07TUFDckMsU0FBUyxRQUFRLE9BQU8sSUFBSSxXQUFXLFFBQVEsYUFBYTtNQUM1RCxRQUFRLFFBQVEsTUFBTSxJQUFJLE9BQU87TUFDakMsUUFBUSxRQUFRLE1BQU0sSUFBSTtNQUMxQixNQUFNO1FBQ0osUUFBUTtVQUFDO1VBQVM7U0FBUztRQUMzQixHQUFJLFFBQVEsSUFBSSxJQUFJLENBQUMsQ0FBQztNQUN4QjtJQUNGO0VBQ0Y7RUFFQSx3QkFBd0IsR0FDeEIsTUFBYSxTQUEwQjtJQUNyQyxJQUFJO01BQ0YsT0FBTyxNQUFNLElBQUksQ0FBQyxDQUFBLE9BQVE7SUFDNUIsU0FBVTtNQUNSLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLFVBQVU7SUFDOUI7RUFDRjtFQUVBLHlCQUF5QixHQUN6QixBQUFVLFFBQWM7SUFDdEIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDLFNBQVM7RUFDeEM7RUFFQSx3QkFBd0IsR0FDeEIsQ0FBQSxPQUFRLEdBQUc7SUFDVCw4QkFBOEI7SUFDOUIsSUFBSSxPQUFPLGNBQWMsYUFBYSxLQUFLLGVBQWUsSUFBSSxDQUFDLENBQUEsU0FBVSxFQUFFO01BQ3pFLE1BQU0sSUFBSSxNQUFNLElBQUksQ0FBQyxLQUFLO0lBQzVCO0lBRUEsTUFBTSxJQUFJLENBQUMsTUFBTTtJQUNqQixJQUFJLENBQUMsQ0FBQSxTQUFVLEdBQUc7SUFFbEIsSUFBSSxDQUFDLE1BQU0sSUFBSSxDQUFDLElBQUksSUFBSTtNQUN0QixPQUFPLElBQUksQ0FBQyxDQUFBLE9BQVE7SUFDdEI7SUFFQSxJQUFJLE9BQU8sSUFBSSxDQUFDLENBQUEsS0FBTSxLQUFLLGFBQWE7TUFDdEMsTUFBTSxJQUFJLE1BQU07SUFDbEI7SUFFQSxJQUFJLENBQUMsS0FBSztJQUNWLE1BQU0saUJBQXFDLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUEsS0FBTTtJQUVuRSxJQUFJLGdCQUFnQjtNQUNsQixJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQzVCLElBQUksQ0FBQyxDQUFBLE9BQVEsQ0FBQyxNQUFNLENBQUMsaUJBQWlCO0lBRTFDO0lBRUEsY0FBYyxhQUFhLEdBQUc7SUFDOUIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsVUFBVTtJQUU1QixPQUFPLElBQUksQ0FBQyxDQUFBLEtBQU07RUFDcEIsRUFBRTtFQUVGLG1CQUFtQixHQUNuQixNQUFnQixTQUF3QjtJQUN0QyxNQUFNLFNBQ0osTUFBTSxRQUFRLEdBQUcsQ0FBQztNQUNoQixJQUFJLENBQUMsT0FBTztNQUNaLElBQUksQ0FBQyxJQUFJO01BQ1QsSUFBSSxDQUFDLE1BQU07S0FDWjtJQUVILE1BQU0sVUFBa0IsT0FBTyxNQUFNLENBQUMsU0FBUyxJQUFJLENBQUM7SUFDcEQsTUFBTSxRQUFRLFFBQVEsS0FBSyxDQUFDO0lBRTVCLE1BQU0sVUFBVTtJQUNoQixNQUFNLGFBQXFCLFVBQ3ZCLE1BQU0sTUFBTSxDQUFDLENBQUMsTUFBTTtNQUNwQixNQUFNLFNBQVMsV0FBVyxNQUFNLE1BQU07TUFDdEMsT0FBTyxPQUFPLENBQUMsU0FBUyxVQUFVLEtBQUssSUFBSSxDQUFDLFNBQVMsV0FBVyxDQUFDO0lBQ25FLEdBQUcsS0FDRCxRQUFRLEtBQUssQ0FBQyxNQUFNLE1BQU07SUFFOUIsTUFBTSxJQUFZLGFBQWEsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEdBQUc7SUFFL0MsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFBLFVBQVcsSUFBSSxJQUFJLENBQUMsQ0FBQSxTQUFVLEVBQUU7TUFDeEMsSUFBSSxDQUFDLEtBQUs7SUFDWjtJQUNBLElBQUksQ0FBQyxDQUFBLFVBQVcsR0FBRztJQUNuQixJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUEsT0FBUSxDQUFDLE1BQU0sQ0FBQztJQUVwRCxJQUFJLEdBQUc7TUFDTCxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUM7SUFDN0I7SUFDQSxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0VBQzFDO0VBRUEsdUVBQXVFLEdBQ3ZFLE1BQWdCLE9BQXlCO0lBQ3ZDLElBQUksT0FBTyxjQUFjLGFBQWEsS0FBSyxhQUFhO01BQ3RELE1BQU0sUUFBbUIsY0FBYyxhQUFhO01BQ3BELE1BQU0sSUFBSSxDQUFDLENBQUEsYUFBYyxDQUFDO0lBQzVCLE9BQU87TUFDTCxNQUFNLFNBQXlCLE1BQU0sSUFBSSxDQUFDLENBQUEsT0FBUTtNQUVsRCxJQUFJLENBQUMsT0FBTyxNQUFNLEVBQUU7UUFDbEIsT0FBTztNQUNUO01BRUEsS0FBSyxNQUFNLFNBQVMsT0FBUTtRQUMxQixNQUFNLElBQUksQ0FBQyxXQUFXLENBQUM7TUFDekI7SUFDRjtJQUVBLE9BQU8sT0FBTyxJQUFJLENBQUMsQ0FBQSxLQUFNLEtBQUs7RUFDaEM7RUFFVSxTQUF3QjtJQUNoQyxPQUFPLElBQUksQ0FBQyxDQUFBLGFBQWMsQ0FBQyxJQUFJLENBQUMsUUFBUTtFQUMxQztFQUVVLFVBQWtCO0lBQzFCLE9BQU8sQ0FBQyxFQUFFLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLEVBQUUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxHQUNyRCxLQUFLLElBQUksQ0FBQyxRQUFRLENBQUMsT0FBTyxJQUFJLElBQUksQ0FBQyxRQUFRO0VBQy9DO0VBRVUsV0FBbUI7SUFDM0IsSUFBSSxpQkFBaUI7SUFDckIsSUFDRSxPQUFPLElBQUksQ0FBQyxRQUFRLENBQUMsT0FBTyxLQUFLLGVBQWUsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLFdBQVcsRUFDMUU7TUFDQSxrQkFBa0IsSUFBSSxDQUFDLEVBQUUsRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQztJQUNsRTtJQUNBLE9BQU87RUFDVDtFQUVBLGdDQUFnQyxHQUNoQyxBQUFVLFFBQVEsS0FBYSxFQUFzQjtJQUNuRCxPQUFPLENBQUMsRUFBRSxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxFQUFFLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUMsR0FDckQsS0FBSyxJQUFJLENBQUMsUUFBUSxDQUFDLE9BQU8sSUFBSSxJQUFJLENBQUMsUUFBUSxLQUMzQyxNQUFNLElBQUksQ0FBQyxRQUFRLENBQUMsT0FBTyxHQUMzQixNQUFNLE1BQU0sSUFBSSxDQUFDLE1BQU0sQ0FBQztFQUM1QjtFQUlVLFNBQTZCO0lBQ3JDLE9BQU8sSUFBSSxDQUFDLEtBQUssTUFBTSxJQUFJLENBQUMsSUFBSTtFQUNsQztFQUVVLFFBQTRCO0lBQ3BDLE9BQU8sSUFBSSxDQUFDLENBQUEsU0FBVSxHQUNsQixJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sR0FBRyxJQUFJLEtBQUssQ0FBQyxFQUFFLFFBQVEsS0FBSyxDQUFDLENBQUMsQ0FBQyxJQUFJLElBQUksQ0FBQyxDQUFBLFNBQVUsSUFDdEU7RUFDTjtFQUVVLE9BQTJCO0lBQ25DLE9BQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLEdBQ3JCLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxHQUNwQixPQUFPLFdBQVcsSUFBSSxDQUFDLEVBQUUsUUFBUSxPQUFPLENBQUMsQ0FBQyxDQUFDLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLEtBQ2pFO0VBQ047RUFFVSxnQkFBZ0IsT0FBZSxFQUFFO0lBQ3pDLElBQUksQ0FBQyxDQUFBLFNBQVUsR0FBRztFQUNwQjtFQUVBOzs7R0FHQyxHQUNELE1BQWdCLFlBQVksS0FBYyxFQUFpQjtJQUN6RCxPQUFRO01BQ04sS0FBSyxNQUFNLElBQUksS0FBSyxPQUFPLE1BQU0sSUFBSTtRQUNuQyxJQUFJLENBQUMsS0FBSztRQUNWLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLFVBQVU7UUFDNUIsS0FBSyxJQUFJLENBQUM7UUFDVjtNQUNGLEtBQUssSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksRUFBRSxVQUFVO1FBQzVDLE1BQU0sSUFBSSxDQUFDLE1BQU07UUFDakI7SUFDSjtFQUNGO0VBeUJBLG9EQUFvRCxHQUNwRCxDQUFBLE9BQVEsR0FBRztJQUNULE1BQU0sT0FBbUIsTUFBTSxJQUFJLENBQUMsQ0FBQSxRQUFTO0lBRTdDLE9BQU8sS0FBSyxNQUFNLEdBQUcsTUFBTSxRQUFRLEVBQUU7RUFDdkMsRUFBRTtFQUVGLGdDQUFnQyxHQUNoQyxDQUFBLFFBQVMsR0FBRztJQUNWLE1BQU0sU0FBUyxJQUFJLFdBQVc7SUFDOUIsTUFBTSxRQUFRLEtBQUssTUFBTSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLEdBQUc7SUFFbEQsSUFBSSxPQUFPO01BQ1QsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUN6QixNQUNBO1FBQUUsUUFBUSxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU07TUFBQztJQUVuQztJQUNBLE1BQU0sUUFBdUIsTUFBTSxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUM7SUFFN0QsSUFBSSxPQUFPO01BQ1QsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDO0lBQzlCO0lBRUEsSUFBSSxVQUFVLE1BQU07TUFDbEIsT0FBTztJQUNUO0lBRUEsT0FBTyxPQUFPLFFBQVEsQ0FBQyxHQUFHO0VBQzVCLEVBQUU7RUFFRjs7Ozs7R0FLQyxHQUNELENBQUEsY0FBZSxHQUFHLENBQUM7SUFDakIsT0FBTyxJQUFJLENBQUMsUUFBUSxDQUFDLFNBQVMsR0FDMUIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsU0FDeEIsSUFBSSxDQUFDLFNBQVMsQ0FBQztFQUNyQixFQUFFO0VBRUY7Ozs7Ozs7OztHQVNDLEdBQ0QsQ0FBQSxhQUFjLEdBQUcsT0FBTztJQUN0QixJQUFJLENBQUMsU0FBUyxPQUFPLElBQUksQ0FBQyxRQUFRLENBQUMsT0FBTyxLQUFLLGFBQWE7TUFDMUQsSUFBSSxDQUFDLENBQUEsS0FBTSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsT0FBTztNQUNuQztJQUNGO0lBRUEsSUFBSSxDQUFDLENBQUEsS0FBTSxHQUFHO0lBQ2QsSUFBSSxDQUFDLENBQUEsU0FBVSxHQUFHO0lBRWxCLE1BQU0sYUFDSixNQUFNLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxRQUFRLEdBQ3pCLElBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLFNBQ3ZCLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTTtJQUUxQixJQUFJLGVBQWUsT0FBTztNQUN4QixJQUFJLENBQUMsQ0FBQSxTQUFVLEdBQUcsQ0FBQyxlQUFlLENBQUM7SUFDckMsT0FBTyxJQUFJLE9BQU8sZUFBZSxVQUFVO01BQ3pDLElBQUksQ0FBQyxDQUFBLFNBQVUsR0FBRztJQUNwQixPQUFPO01BQ0wsSUFBSSxDQUFDLENBQUEsS0FBTSxHQUFHLElBQUksQ0FBQyxDQUFBLGNBQWUsQ0FBQztJQUNyQztFQUNGLEVBQUU7RUFFRjs7Ozs7R0FLQyxHQUNELEFBQVUsTUFDUixJQUFzQixFQUN0QixJQUFXLEVBQ1gsS0FBYyxFQUNMO0lBQ1QsbUNBQW1DO0lBQ25DLE1BQU0sV0FBdUMsTUFBTSxDQUFDLEtBQUs7SUFDekQsT0FBTyxPQUFPLGFBQWEsZUFBZSxDQUN4QyxBQUFDLE9BQU8sTUFBTSxJQUFJLEtBQUssZUFDckIsU0FBUyxPQUFPLENBQUMsTUFBTSxJQUFJLE1BQU0sQ0FBQyxLQUNuQyxPQUFPLE1BQU0sUUFBUSxLQUFLLGVBQ3pCLFNBQVMsT0FBTyxDQUFDLE1BQU0sUUFBUSxNQUFNLENBQUMsQ0FDMUM7RUFDRjtBQUNGO0FBRUEsU0FBUztFQUNQLElBQUk7SUFDRiw2RUFBNkU7SUFDN0UsT0FBTyxLQUFLLFdBQVcsR0FBRyxPQUFPLElBQUk7RUFDdkMsRUFBRSxPQUFPLFFBQVE7SUFDZixPQUFPO0VBQ1Q7QUFDRiJ9
// denoCacheMetadata=10489203349548140693,10843350229468740456